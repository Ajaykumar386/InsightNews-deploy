<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>InsightNews Sentiment Analysis</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        body.light-theme {
            background-color: #f8f9fa;
            color: #212529;
        }

        body.dark-theme {
            background-color: #212529;
            color: #f8f9fa;
        }

        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out,
                background-color 0.3s, border 0.3s;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card.light-theme {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
        }

        .card.dark-theme {
            background-color: #343a40;
            border: 1px solid #454d55;
        }

        .card img {
            height: 150px;
            object-fit: cover;
        }

        .card-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .card-title,
        .card-text {
            flex-grow: 1;
            margin-bottom: 10px;
        }

        .card .btn {
            margin-top: auto;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
        }

        .theme-switch-wrapper {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            z-index: 1050;
        }

        .theme-switch {
            display: flex;
            align-items: center;
        }

        .theme-switch input {
            height: 0;
            width: 0;
            visibility: hidden;
        }

        .theme-switch label {
            cursor: pointer;
            text-indent: -9999px;
            width: 52px;
            height: 27px;
            background: grey;
            display: block;
            border-radius: 100px;
            position: relative;
            margin: 0 10px;
        }

        .theme-switch label:after {
            content: "";
            position: absolute;
            top: 2px;
            left: 2px;
            width: 23px;
            height: 23px;
            background: #fff;
            border-radius: 90px;
            transition: 0.3s;
        }

        .theme-switch input:checked+label {
            background: #007bff;
        }

        .theme-switch input:checked+label:after {
            left: calc(100% - 2px);
            transform: translateX(-100%);
        }

        .theme-switch label:active:after {
            width: 30px;
        }

        .theme-icon {
            font-size: 1.5em;
        }

        .card-link {
            text-decoration: none;
            color: inherit;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1050;
        }

        .loading-spinner {
            text-align: center;
            color: white;
            font-size: 2rem;
        }

        .pagination .page-item.disabled .page-link {
            color: #6c757d;
            pointer-events: none;
            cursor: default;
        }

        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }

        .page-input {
            width: 80px;
            min-width: 60px;
            text-align: center;
        }

        .footer-card {
            background-color: #ff6f00;
            color: #000000;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: inline-block;
            max-width: 500px;
            margin: 0 auto;
        }

        .footer-card a {
            color: #ffffff;
            text-decoration: none;
        }

        .footer-card a:hover {
            text-decoration: underline;
        }

        .theme.light-theme {
            background-color: #ffffff;
            color: #212529;
        }

        .theme.dark-theme {
            background-color: #343a40;
            color: #f8f9fa;
        }

        .theme .modal-header,
        .theme .modal-body {
            border-color: transparent;
        }

        .theme.dark-theme .modal-header,
        .theme.dark-theme .modal-body {
            border-color: #454d55;
        }

        .theme .modal-header .close span {
            color: inherit;
        }

        .btn-custom {
            background-color: slateblue;
            color: white;
        }

        .btn-custom:hover {
            background-color: darkslateblue;
            color: white;
        }

        .capitalize-text {
            text-transform: capitalize;
        }

        .animated-text {
            color: #00ffe5;
            font-weight: bold;
            animation: fadeColorChange 3s infinite;
        }

        @keyframes fadeColorChange {
            0% {
                color: #00ffe5;
                opacity: 1;
            }

            50% {
                color: #ff007a;
                opacity: 0.5;
            }

            100% {
                color: #00ffe5;
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 style="
          background-color: #ff6f00;
          color: #ffffff;
          padding: 20px;
          text-align: center;
          border-radius: 5px;
        ">
            <a href="/" style="color: #fff;">InsightNews Sentiment Analysis üì∞</a>
        </h1>
        <div class="alert alert-info" role="alert">
            Welcome to InsightNews Sentiment Analysis! Search and analyze news articles to uncover sentiment trends,
            distribution, and insights from various sources and authors. Utilize advanced search options for a more
            refined search experience, including regular expression support for keyword, author, title, and source
            searches. For detailed instructions on how to use the application, click <a href="#" data-toggle="modal"
                data-target="#learnMoreModal">here</a>.
        </div>
        <div class="alert alert-warning" role="alert">
            News data is available from {{ date_min }} to {{ date_max }}. If you require additional data for sentiment
            analysis, please <a href="#contact-us">contact us</a>.
        </div>
        <form method="POST" action="{{ url_for('index') }}" class="my-4">
            <div class="form-row">
                <div class="form-group col-md-5">
                    <label for="query">Search (supports regex):</label>
                    <input type="text" class="form-control" id="query" name="query"
                        placeholder="Search by topic, author, title, or source" value="{{ query }}" />
                </div>
                <div class="form-group col-md-2">
                    <label for="from_date">From Date:</label>
                    <input type="date" class="form-control" id="from_date" name="from_date"
                        value="{{ from_date or '2024-06-01' }}" />
                </div>
                <div class="form-group col-md-2">
                    <label for="to_date">To Date:</label>
                    <input type="date" class="form-control" id="to_date" name="to_date"
                        value="{{ to_date or '2024-06-30' }}" />
                </div>
                <div class="form-group col-md-1.5">
                    <label for="sentiment_model">Model:</label>
                    <select class="form-control" id="sentiment_model" name="sentiment_model">
                        <option value="roberta_sentiment" {% if sentiment_model=='roberta_sentiment' %}selected{% endif
                            %}>RoBERTa</option>
                        <option value="distilbert_sentiment" {% if sentiment_model=='distilbert_sentiment' %}selected{%
                            endif %}>DistilBERT</option>
                    </select>
                </div>
                <div class="form-group col-md-1.5">
                    <label for="sentiment">Sentiment:</label>
                    <select class="form-control" id="sentiment" name="sentiment">
                        <option value="" {% if sentiment=='' %}selected{% endif %}>All</option>
                        <option value="positive" {% if sentiment=='positive' %}selected{% endif %}>Positive</option>
                        <option value="neutral" {% if sentiment=='neutral' %}selected{% endif %}>Neutral</option>
                        <option value="negative" {% if sentiment=='negative' %}selected{% endif %}>Negative</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-md-12 d-flex justify-content-center">
                <button type="submit" name="action" value="search" class="btn btn-primary mr-2">Search Articles
                    üîç</button>
                <button type="submit" name="action" value="analytics" class="btn btn-info mr-2">Get Analytics
                    üìä</button>
                <button type="button" class="btn btn-custom" data-toggle="modal"
                    data-target="#advancedSearchModal">Advanced Search üßë‚Äçüíª</button>
            </div>
        </form>

        <div id="loading-overlay" class="loading-overlay" style="display: none">
            <div class="loading-spinner">
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <div id="loading-progress" class="mt-2">0% Loaded</div>
            </div>
        </div>

        <!-- Articles Section -->
        <div id="articles-container" style="{% if action == 'analytics' %}display: none{% endif %}">
            {% if articles %}
            <h2 class="my-4">
                {{ heading }}
                <button class="btn btn-outline-secondary btn-sm" data-toggle="modal" data-target="#sortModal">
                    <i class="fas fa-filter"></i>
                </button>
                <br>
                <small class="text-muted">({{ total }} articles found)</small>
            </h2>
            <div class="row">
                {% for article in articles %}
                <div class="col-md-4 mb-4">
                    <a href="{{ article.url }}" class="card-link">
                        <div class="card {{ 'dark-theme' if theme == 'dark' else 'light-theme' }}">
                            <img src="{{ article.image }}" class="card-img-top" alt="Image for {{ article.topic }}" />
                            <div class="card-body">
                                <h5 class="card-title">{{ article.title }}</h5>
                                <p class="card-text capitalize-text"><strong>Summary:</strong> {{ article.bart_summary
                                    }}</p>
                                <p class="card-text"><strong>Sentiment:</strong> {{ article[sentiment_model] }}</p>
                                <p class="card-text"><strong>Published on:</strong> {{ article.published_at|dateformat
                                    }}</p>
                                <a href="{{ article.url }}" class="btn btn-primary mt-auto" target="_blank">Read
                                    more</a>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if pagination.has_prev %}
                    <li class="page-item">
                        <a class="page-link page-nav"
                            href="{{ url_for('index', page=1, to_date=to_date if to_date else None, from_date=from_date if from_date else None, query=query if query else None, author=author if author else None, title=title if title else None, source=source if source else None, sentiment=sentiment if sentiment else None, sentiment_model=sentiment_model if sentiment_model else None, sort_by=sort_by) }}"
                            aria-label="First" title="Go to first page">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link page-nav"
                            href="{{ url_for('index', page=pagination.page - 1, to_date=to_date if to_date else None, from_date=from_date if from_date else None, query=query if query else None, author=author if author else None, title=title if title else None, source=source if source else None, sentiment=sentiment if sentiment else None, sentiment_model=sentiment_model if sentiment_model else None, sort_by=sort_by) }}"
                            aria-label="Previous" title="Go to previous page">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}
                    <li class="page-item active d-flex align-items-center" data-current-page="{{ pagination.page }}">
                        <span class="align-self-center">Page&nbsp;</span>
                        <input type="number" id="page-input" class="form-control page-input"
                            value="{{ pagination.page }}" min="1" max="{{ pagination.pages }}"
                            aria-label="Page number" />
                        <span class="align-self-center mx-2">
                            of {{ pagination.pages }}</span>
                    </li>
                    {% if pagination.has_next %}
                    <li class="page-item">
                        <a class="page-link page-nav"
                            href="{{ url_for('index', page=pagination.page + 1, to_date=to_date if to_date else None, from_date=from_date if from_date else None, query=query if query else None, author=author if author else None, title=title if title else None, source=source if source else None, sentiment=sentiment if sentiment else None, sentiment_model=sentiment_model if sentiment_model else None, sort_by=sort_by) }}"
                            aria-label="Next" title="Go to next page">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link page-nav"
                            href="{{ url_for('index', page=pagination.pages, to_date=to_date if to_date else None, from_date=from_date if from_date else None, query=query if query else None, author=author if author else None, title=title if title else None, source=source if source else None, sentiment=sentiment if sentiment else None, sentiment_model=sentiment_model if sentiment_model else None, sort_by=sort_by) }}"
                            aria-label="Last" title="Go to last page">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% else %}
            <div class="d-flex justify-content-center">
                <div>
                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    {% for category, message in messages %}
                    <div class="alert alert-{{ category }} text-center" role="alert">
                        {{ message|safe }}
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" style="{% if action != 'analytics' %}display: none{% endif %}">
            {% if graph_html and bar_chart_html and pie_chart_html and source_html and author_html and geo_html and
            length_html and topic_html %}
            <h2 class="my-4">
                {% if query and from_date and to_date %} Analytics for "{{ query }}"
                from {{ from_date|dateformat }} to {{ to_date|dateformat }} {% elif
                query and from_date %} Searched for "{{ query }}" from {{
                from_date|dateformat }} {% elif query and to_date %} Searched for "{{
                query }}" up to {{ to_date|dateformat }} {% elif from_date and to_date
                %} Searched from {{ from_date|dateformat }} to {{ to_date|dateformat
                }} {% elif from_date %} Searched from {{ from_date|dateformat }} {%
                elif to_date %} Searched up to {{ to_date|dateformat }} {% elif query
                %} Searched for "{{ query }}" {% else %} Latest News {% endif %}
                <br>
                <small class="text-muted">({{ total }} articles found)</small>
            </h2>
            <!-- Sentiment Trend Line Chart -->
            <div class="card">
                <div class="card-header">
                    <strong>Sentiment Trend Over Time</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-trend">
                        {{ graph_html | safe }}
                    </div>
                </div>
            </div>
            <br>

            <!-- Sentiment Distribution Across Topics Bar Chart -->
            <div class="card">
                <div class="card-header">
                    <strong>Sentiment Distribution Across Topics</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-topic-bar">
                        {{ bar_chart_html | safe }}
                    </div>
                </div>
            </div>
            <br>

            <!-- Sentiment Classification Pie Chart -->
            <div class="card">
                <div class="card-header">
                    <strong>Sentiment Classification Distribution</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-pie">
                        {{ pie_chart_html | safe }}
                    </div>
                </div>
            </div>
            <br>

            <!-- Top 10 Sources by Sentiment -->
            <div class="card">
                <div class="card-header">
                    <strong>Top 10 Sources by Sentiment</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-source">
                        {{ source_html | safe }}
                    </div>
                </div>
            </div>
            <br>

            <!-- Top 10 Authors by Sentiment -->
            <div class="card">
                <div class="card-header">
                    <strong>Top 10 Authors by Sentiment</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-author">
                        {{ author_html | safe }}
                    </div>
                </div>
            </div>
            <br>

            <!-- Geographical Sentiment Distribution -->
            <div class="card">
                <div class="card-header">
                    <strong>Geographical Sentiment Distribution</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-geo">
                        {{ geo_html | safe }}
                    </div>
                </div>
            </div>
            <br>

            <!-- Sentiment by Article Length -->
            <div class="card">
                <div class="card-header">
                    <strong>Sentiment by Article Length</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-length">
                        {{ length_html | safe }}
                    </div>
                </div>
            </div>
            <br>

            <!-- Trending Topics with Sentiment -->
            <div class="card">
                <div class="card-header">
                    <strong>Trending Topics with Sentiment</strong>
                </div>
                <div class="card-body">
                    <div id="sentiment-topic">
                        {{ topic_html | safe }}
                    </div>
                </div>
            </div>
            {% endif %}
            <div class="d-flex justify-content-center">
                <div>
                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    {% for category, message in messages %}
                    <div class="alert alert-{{ category }} text-center" role="alert">
                        {{ message|safe }}
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>
    </div>
    <div class="theme-switch-wrapper">
        <i class="fas fa-sun theme-icon"></i>
        <div class="theme-switch">
            <input type="checkbox" id="theme-toggle" />
            <label for="theme-toggle" class="switch-label">Toggle Theme</label>
        </div>
        <i class="fas fa-moon theme-icon"></i>
    </div>

    <!-- Sort Modal -->
    <div class="modal fade" id="sortModal" tabindex="-1" role="dialog" aria-labelledby="sortModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
            <div class="modal-content theme">
                <div class="modal-header">
                    <h5 class="modal-title" id="sortModalLabel">Sort Articles</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <div class="form-group">
                        <label for="sort_by">Sort By:</label>
                        <select class="form-control" id="sort_by_modal" name="sort_by_modal">
                            <option value="desc" {% if sort_by=='desc' %}selected{% endif %}>Newest First</option>
                            <option value="asc" {% if sort_by=='asc' %}selected{% endif %}>Oldest First</option>
                            <option value="alphabetical_asc" {% if sort_by=='alphabetical_asc' %}selected{% endif %}>
                                Alphabetically (A-Z)
                            </option>
                            <option value="alphabetical_desc" {% if sort_by=='alphabetical_desc' %}selected{% endif %}>
                                Alphabetically (Z-A)
                            </option>
                            <option value="relevance_desc" {% if sort_by=='relevance_desc' %}selected{% endif %}>
                                Relevance (High to Low)
                            </option>
                            <option value="relevance_asc" {% if sort_by=='relevance_asc' %}selected{% endif %}>
                                Relevance (Low to High)
                            </option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="applySort" class="btn btn-primary">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Search Modal -->
    <div class="modal fade" id="advancedSearchModal" tabindex="-1" role="dialog"
        aria-labelledby="advancedSearchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
            <div class="modal-content theme">
                <div class="modal-header">
                    <h5 class="modal-title" id="advancedSearchModalLabel">Advanced Search üßë‚Äçüíª</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <form method="POST" action="{{ url_for('index') }}">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="query">Keyword (supports regex):</label>
                                <input type="text" class="form-control" id="query" name="query"
                                    placeholder="Keyword (supports regex)" value="{{ query }}">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="author">Author (supports regex):</label>
                                <input type="text" class="form-control" id="author" name="author"
                                    placeholder="Author (supports regex)" value="{{ author }}">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="title">Title (supports regex):</label>
                                <input type="text" class="form-control" id="title" name="title"
                                    placeholder="Title (supports regex)" value="{{ title }}">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="source">Source (supports regex):</label>
                                <input type="text" class="form-control" id="source" name="source"
                                    placeholder="Source (supports regex)" value="{{ source }}">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="from_date">From Date:</label>
                                <input type="date" class="form-control" id="from_date" name="from_date"
                                    value="{{ from_date or '2024-06-01' }}">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="to_date">To Date:</label>
                                <input type="date" class="form-control" id="to_date" name="to_date"
                                    value="{{ to_date or '2024-06-30' }}">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="sentiment_model-adv">Sentiment Model:</label>
                                <select class="form-control" id="sentiment_model-adv" name="sentiment_model">
                                    <option value="roberta_sentiment" {% if sentiment_model=='roberta_sentiment'
                                        %}selected{% endif %}>RoBERTa Model</option>
                                    <option value="distilbert_sentiment" {% if sentiment_model=='distilbert_sentiment'
                                        %}selected{% endif %}>DistilBERT Model</option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="sentiment-adv">Sentiment:</label>
                                <select class="form-control" id="sentiment-adv" name="sentiment">
                                    <option value="" {% if sentiment=='' %}selected{% endif %}>All</option>
                                    <option value="positive" {% if sentiment=='positive' %}selected{% endif %}>Positive
                                    </option>
                                    <option value="neutral" {% if sentiment=='neutral' %}selected{% endif %}>Neutral
                                    </option>
                                    <option value="negative" {% if sentiment=='negative' %}selected{% endif %}>Negative
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col-md-6">
                                <button type="submit" name="action" value="search" class="btn btn-primary w-100">Search
                                    Articles üîç</button>
                            </div>
                            <div class="col-md-6">
                                <button type="submit" name="action" value="analytics" class="btn btn-info w-100">Get
                                    Analytics üìä</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Learn More Modal -->
    <div class="modal fade" id="learnMoreModal" tabindex="-1" role="dialog" aria-labelledby="learnMoreModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
            <div class="modal-content theme">
                <div class="modal-header">
                    <h5 class="modal-title" id="learnMoreModalLabel">How to Use</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <p>This application allows you to search for news articles and get insights based on sentiment
                        analysis. Here‚Äôs how you can use it:</p>

                    <h6><strong>Search Articles</strong></h6>
                    <p>Use the following filters to search for articles:</p>
                    <ul>
                        <li><strong>Keyword:</strong> Search for specific words or phrases within the articles to find
                            relevant content. You can also use regular expressions for more advanced searches. For
                            example, use
                            <code>corona|covid</code> to find articles containing either "corona" or "covid".
                        </li>
                        <li><strong>Date Range:</strong> Select a date range to find articles published within a
                            specific period. You can choose a start date and an end date to narrow down the search
                            results.</li>
                        <li><strong>Sentiment Model:</strong> Choose between different sentiment analysis models:
                            <ul>
                                <li><strong>RoBERTa:</strong> Provides sentiment analysis with three categories -
                                    Positive, Neutral, and Negative. This model is suitable for news articles as it can
                                    capture a wide range of sentiments, reflecting the varied nature of news content.
                                </li>
                                <li><strong>DistilBERT:</strong> Provides sentiment analysis with two categories -
                                    Positive and Negative. This model is suitable for news articles that primarily
                                    convey clear positive or negative sentiments, simplifying the sentiment analysis
                                    process.</li>
                            </ul>
                        </li>
                        <li><strong>Sentiment:</strong> Filter articles based on their sentiment (positive, neutral, or
                            negative). This allows you to focus on articles that convey a particular tone or emotion.
                        </li>
                    </ul>

                    <h6><strong>Get Analytics</strong></h6>
                    <p>Use the "Get Analytics" button to gain insights into the articles you searched for. The analytics
                        feature provides:</p>
                    <ul>
                        <li><strong>Sentiment Trend Over Time:</strong> Visualize how the sentiment of articles has
                            changed over a specified period.</li>
                        <li><strong>Sentiment Distribution Across Topics:</strong> See how different topics are
                            represented in terms of sentiment.</li>
                        <li><strong>Sentiment Classification Distribution:</strong> Get a breakdown of the proportion of
                            positive, neutral, and negative articles.</li>
                        <li><strong>Top 10 Sources by Sentiment:</strong> Identify the top sources and their sentiment
                            distribution.</li>
                        <li><strong>Top 10 Authors by Sentiment:</strong> Discover the most prolific authors and their
                            sentiment patterns.</li>
                        <li><strong>Geographical Sentiment Distribution:</strong> Explore the sentiment distribution of
                            articles based on their geographical origin.</li>
                        <li><strong>Sentiment by Article Length:</strong> Analyze how the length of articles correlates
                            with their sentiment.</li>
                        <li><strong>Trending Topics with Sentiment:</strong> Identify trending topics and their
                            associated sentiment.</li>
                    </ul>

                    <h6><strong>Advanced Search</strong></h6>
                    <p>For additional search options, use the "Advanced Search" button:</p>
                    <ul>
                        <li><strong>Author:</strong> Find articles written by a specific author. This is useful if you
                            are looking for content by a particular journalist or writer. Regular expressions are
                            supported. For example, use
                            <code>John|Jane</code> to find articles written by either "John" or "Jane".
                        </li>
                        <li><strong>Title:</strong> Search for articles with specific words or phrases in the title.
                            This helps in finding articles that focus on a particular topic or event. Regular
                            expressions are supported. For example, use <code>Vaccine|COVID</code> to find articles with
                            either "Vaccine" or "COVID" in the title.</li>
                        <li><strong>Source:</strong> Filter articles from specific news sources. This is useful if you
                            prefer articles from certain publications or websites. Regular expressions are supported.
                            For example, use <code>CNN|BBC</code> to find articles from either "CNN" or "BBC".
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Load scripts at the end of the body to prevent blocking -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        // Show the "Learn More" modal on the first visit
        $(document).ready(function () {
            if (!localStorage.getItem('learnMoreShown')) {
                $('#learnMoreModal').modal('show');
                localStorage.setItem('learnMoreShown', 'true');
            }
        });
        // Show the loading placeholder
        function showLoading() {
            $("#loading-overlay").fadeIn();
            simulateLoading();
        }
        // Hide the loading placeholder
        function hideLoading() {
            $("#loading-overlay").fadeOut();
        }
        // Simulate loading progress
        function simulateLoading() {
            let percentage = 0;
            const interval = setInterval(function () {
                if (percentage >= 100) {
                    clearInterval(interval);
                } else {
                    percentage += 1;
                    $("#loading-progress").text(percentage + "% Loaded");
                }
            }, 50);
        }
        // Apply theme based on saved preference
        function applyTheme(theme) {
            const body = document.body;
            body.classList.toggle("dark-theme", theme === "dark");
            body.classList.toggle("light-theme", theme !== "dark");
            document.querySelectorAll(".card, .theme").forEach((element) => {
                element.classList.toggle("dark-theme", theme === "dark");
                element.classList.toggle("light-theme", theme !== "dark");
            });
            document.getElementById("theme-toggle").checked = theme === "dark";
            updatePlotlyTheme(theme);
        }
        // Toggle theme between light and dark
        function toggleTheme() {
            const theme =
                localStorage.getItem("theme") === "dark" ? "light" : "dark";
            localStorage.setItem("theme", theme);
            applyTheme(theme);
        }
        // Update Plotly charts theme
        function updatePlotlyTheme(theme) {
            const layoutDark = {
                paper_bgcolor: "#212529",
                plot_bgcolor: "#212529",
                font: { color: "#f8f9fa" },
                xaxis: {
                    gridcolor: '#444',
                    linecolor: '#888',
                    zerolinecolor: '#888'
                },
                yaxis: {
                    gridcolor: '#444',
                    linecolor: '#888',
                    zerolinecolor: '#888'
                }
            };
            const layoutLight = {
                paper_bgcolor: "#f8f9fa",
                plot_bgcolor: "#f8f9fa",
                font: { color: "#212529" },
                xaxis: {
                    gridcolor: '#ddd',
                    linecolor: '#aaa',
                    zerolinecolor: '#aaa'
                },
                yaxis: {
                    gridcolor: '#ddd',
                    linecolor: '#aaa',
                    zerolinecolor: '#aaa'
                }
            };
            const layout = theme === "dark" ? layoutDark : layoutLight;

            const charts = ['sentiment-trend', 'sentiment-topic-bar', 'sentiment-pie', 'sentiment-source', 'sentiment-author', 'sentiment-wordcloud', 'sentiment-geo', 'sentiment-length', 'sentiment-topic', 'sentiment-intensity'];
            charts.forEach(chartId => {
                const chartDiv = document.getElementById(chartId);
                if (chartDiv && chartDiv.data) {
                    Plotly.relayout(chartDiv, layout);
                }
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            const savedTheme = localStorage.getItem("theme") || "dark";
            applyTheme(savedTheme);
            document.getElementById("theme-toggle").addEventListener("change", toggleTheme);

            // Get the current page from data attribute and set the page input
            const currentPageElement = document.querySelector(".pagination .page-item.active");
            if (currentPageElement) {
                const currentPage = currentPageElement.dataset.currentPage;
                document.getElementById("page-input").value = currentPage;
            }

            // Set dynamic default dates
            document.getElementById("from_date").value = document.getElementById("from_date").value || "2024-06-01";
            document.getElementById("to_date").value = document.getElementById("to_date").value || "2024-06-30";

            // Sentiment Model Selectors and Event Handlers
            const sentimentSelect = document.getElementById("sentiment");
            const sentimentSelectAdv = document.getElementById("sentiment-adv");
            const sentimentModelSelect = document.getElementById("sentiment_model");
            const sentimentModelSelectAdv = document.getElementById("sentiment_model-adv");

            const robertaOptions = [
                { value: "", text: "All" },
                { value: "positive", text: "Positive" },
                { value: "neutral", text: "Neutral" },
                { value: "negative", text: "Negative" },
            ];

            const distilbertOptions = [
                { value: "", text: "All" },
                { value: "positive", text: "Positive" },
                { value: "negative", text: "Negative" },
            ];

            function updateSentimentOptions() {
                const selectedModel = sentimentModelSelect.value;
                sentimentSelect.innerHTML = "";

                let options = selectedModel === "distilbert_sentiment" ? distilbertOptions : robertaOptions;
                options.forEach(option => {
                    let opt = document.createElement("option");
                    opt.value = option.value;
                    opt.textContent = option.text;
                    sentimentSelect.appendChild(opt);
                });

                // Set the previously selected sentiment
                sentimentSelect.value = "{{ sentiment }}";
            }

            function updateSentimentOptionsAdv() {
                const selectedModel = sentimentModelSelectAdv.value;
                sentimentSelectAdv.innerHTML = "";

                let options = selectedModel === "distilbert_sentiment" ? distilbertOptions : robertaOptions;
                options.forEach(option => {
                    let opt = document.createElement("option");
                    opt.value = option.value;
                    opt.textContent = option.text;
                    sentimentSelectAdv.appendChild(opt);
                });

                // Set the previously selected sentiment
                sentimentSelectAdv.value = "{{ sentiment }}";
            }

            sentimentModelSelect.addEventListener("change", updateSentimentOptions);
            sentimentModelSelectAdv.addEventListener("change", updateSentimentOptionsAdv);
            updateSentimentOptions();
            updateSentimentOptionsAdv();

            // Sort by button click handler
            document.getElementById("applySort").addEventListener("click", applySort);

            // Function to apply sort
            function applySort() {
                const sortBy = document.getElementById("sort_by_modal").value;
                const url = new URL(window.location.href);

                const params = new URLSearchParams(url.search);
                params.set("sort_by", sortBy);

                // Get other search parameters from the form
                const query = document.getElementById("query").value;
                const author = document.getElementById("author").value;
                const title = document.getElementById("title").value;
                const source = document.getElementById("source").value;
                const from_date = document.getElementById("from_date").value;
                const to_date = document.getElementById("to_date").value;
                const sentiment = document.getElementById("sentiment").value;
                const sentiment_model = document.getElementById("sentiment_model").value;

                if (query) params.set("query", query);
                if (author) params.set("author", author);
                if (title) params.set("title", title);
                if (source) params.set("source", source);
                if (from_date) params.set("from_date", from_date);
                if (to_date) params.set("to_date", to_date);
                if (sentiment) params.set("sentiment", sentiment);
                if (sentiment_model) params.set("sentiment_model", sentiment_model);

                window.location.href = `${url.pathname}?${params.toString()}`;
            }

            // Form submission event handler
            $("form").on("submit", function () {
                showLoading();
                // Allow the form to submit naturally
            });

            // Pagination link click event handler
            $(document).on("click", ".page-nav", function (e) {
                e.preventDefault();
                showLoading();
                window.location.href = $(this).attr("href");
            });

            // Update page input change event handler to include max page validation
            $("#page-input").on("change", function () {
                let page = $(this).val();
                let maxPage = parseInt($(this).attr("max"), 10);
                if (page < 1 || isNaN(page)) page = 1;
                if (page > maxPage) page = maxPage;
                showLoading();
                const url = new URL(window.location.href);
                const params = new URLSearchParams(url.search);
                params.set("page", page);
                window.location.href = `${url.pathname}?${params.toString()}`;
            });

            // Ensure loading placeholder is hidden after page load
            $(window).on("load", function () {
                hideLoading();
            });
        });

    </script>
    <footer id="contact-us" class="text-center mt-5 py-4">
        <div class="footer-card">
            <p class="mb-0">
                Submission by <a href="mailto:vv7988@rit.edu">Venkata Ajay Kumar Vutty</a>
            </p>
        </div>
    </footer>
</body>
</html>